<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Каталог - Виниловые пластинки</title>
    <link rel="stylesheet" href="../styles/catalog.css" />
  </head>
  <body>
    <header>
      <div class="logo">Виниловый Магазин</div>
      <nav>
        <ul>
          <li><a href="index.html">Главная</a></li>
          <li><a href="catalog.html" class="active">Каталог</a></li>
          <li><a href="cart.html">Корзина</a></li>
          <li><a href="care.html">Уход за винилом</a></li>
          <li><a href="add_vinyl.html">Добавить пластинку</a></li>
          <li><a href="about.html">О нас</a></li>
        </ul>
      </nav>
    </header>

    <main class="main-content">
      <div class="catalog-div">
        <h1>Каталог виниловых пластинок</h1>
        <div class="catalog">
          <div class="record-card">
            <div class="image-container">
              <img
                src="../images/joydivisionUnknownPleasures.jpg"
                alt="обложка Unknown Pleasures"
              />
            </div>
            <h2 class="title">Unknown Pleasures</h2>
            <p class="artist">Joy Division</p>
            <p class="genres">Постпанк, Альтернатива</p>
            <p class="price">3500 руб.</p>
            <a href="vinyl1.html" class="details-link">Подробнее</a>
          </div>
          <div class="record-card">
            <div class="image-container">
              <img src="../images/closer.jpg" alt="Обложка Closer" />
            </div>
            <h2 class="title">Closer</h2>
            <p class="artist">Joy Division</p>
            <p class="genres">Постпанк, Альтернатива</p>
            <p class="price">3800 руб.</p>
            <a href="vinyl2.html" class="details-link">Подробнее</a>
          </div>
          <div class="record-card">
            <div class="image-container">
              <img src="../images/faith.jpeg" alt="Обложка Faith" />
            </div>
            <h2 class="title">Faith</h2>
            <p class="artist">The Cure</p>
            <p class="genres">Готик-рок, Альтернатива</p>
            <p class="price">3600 руб.</p>
            <a href="vinyl3.html" class="details-link">Подробнее</a>
          </div>
          <div class="record-card">
            <div class="image-container">
              <img
                src="../images/in_the_flat_field..jpg"
                alt="Обложка In the Flat Field"
              />
            </div>
            <h2 class="title">In the Flat Field</h2>
            <p class="artist">Bauhaus</p>
            <p class="genres">Постпанк, Готик-рок</p>
            <p class="price">3700 руб.</p>
            <a href="vinyl4.html" class="details-link">Подробнее</a>
          </div>
        </div>
      </div>

      <aside class="sidebar">
        <div class="filters">
          <h2>Фильтры</h2>
          <label>
            Жанр:
            <select id="genre-filter">
              <option value="all">Все жанры</option>
              <option value="постпанк">Постпанк</option>
              <option value="альтернатива">Альтернатива</option>
              <option value="готик-рок">Готик-рок</option>
            </select>
          </label>
          <label>
            Поиск:
            <input
              type="text"
              id="search-input"
              placeholder="Название альбома"
            />
          </label>
          <label>
            Цена от:
            <input type="number" id="price-from" min="0" placeholder="0" />
          </label>
          <label>
            Цена до:
            <input type="number" id="price-to" min="0" placeholder="10000" />
          </label>
          <button id="apply-filters">Применить фильтры</button>
        </div>

        <div class="sort">
          <h2>Сортировка</h2>
          <label>
            Сортировать по:
            <select id="sort-filter">
              <option value="title">Названию альбома</option>
              <option value="artist">Исполнителю</option>
              <option value="price">Цене</option>
            </select>
          </label>
          <label>
            Порядок:
            <select id="sort-order">
              <option value="asc">По возрастанию</option>
              <option value="desc">По убыванию</option>
            </select>
          </label>
          <button id="apply-sort">Применить сортировку</button>
        </div>
      </aside>
    </main>

    <footer>
      <p>&copy; 2024 Виниловый Магазин. Все права защищены.</p>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const genreFilter = document.getElementById("genre-filter");
        const searchInput = document.getElementById("search-input");
        const priceFromInput = document.getElementById("price-from");
        const priceToInput = document.getElementById("price-to");
        const applyFiltersBtn = document.getElementById("apply-filters");

        const sortFilter = document.getElementById("sort-filter");
        const sortOrder = document.getElementById("sort-order");
        const applySortBtn = document.getElementById("apply-sort");

        const records = Array.from(document.querySelectorAll(".record-card"));

        function validatePriceInputs() {
          if (parseFloat(priceFromInput.value) < 0) {
            alert("Цена 'от' не может быть отрицательной!");
            priceFromInput.value = 0;
          }

          if (parseFloat(priceToInput.value) < 0) {
            alert("Цена 'до' не может быть отрицательной!");
            priceToInput.value = 0;
          }
        }

        function filterAndSortRecords() {
          validatePriceInputs();

          const genre = genreFilter.value.toLowerCase();
          const searchQuery = searchInput.value.toLowerCase();
          const priceFrom = parseFloat(priceFromInput.value) || 0;
          const priceTo = parseFloat(priceToInput.value) || Infinity;
          const sortBy = sortFilter.value;
          const order = sortOrder.value;

          const filteredRecords = records.filter((record) => {
            const recordGenre = record
              .querySelector(".genres")
              .textContent.toLowerCase();
            const recordTitle = record
              .querySelector("h2")
              .textContent.toLowerCase();
            const recordPrice = parseFloat(
              record.querySelector(".price").textContent
            );

            const matchesGenre = genre === "all" || recordGenre.includes(genre);
            const matchesSearch = recordTitle.includes(searchQuery);
            const matchesPrice =
              recordPrice >= priceFrom && recordPrice <= priceTo;

            return matchesGenre && matchesSearch && matchesPrice;
          });

          const sortedRecords = filteredRecords.sort((a, b) => {
            const aValue = a
              .querySelector(`.${sortBy}`)
              .textContent.toLowerCase();
            const bValue = b
              .querySelector(`.${sortBy}`)
              .textContent.toLowerCase();

            if (aValue < bValue) return order === "asc" ? -1 : 1;
            if (aValue > bValue) return order === "asc" ? 1 : -1;
            return 0;
          });

          const catalog = document.querySelector(".catalog");
          catalog.innerHTML = "";
          sortedRecords.forEach((record) => catalog.appendChild(record));
        }

        applyFiltersBtn.addEventListener("click", filterAndSortRecords);
        applySortBtn.addEventListener("click", filterAndSortRecords);

        priceFromInput.addEventListener("blur", validatePriceInputs);
        priceToInput.addEventListener("blur", validatePriceInputs);
      });
    </script>
  </body>
</html>
