  <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Каталог - Виниловые пластинки</title>
      <link rel="stylesheet" href="../styles/catalog.css" />
    </head>
    <body>
    <header>
      <div class="logo">Виниловый Магазин</div>
      <nav>
        <ul>
          <li><a href="index.html">Главная</a></li>
          <li><a href="catalog.html" class="active">Каталог</a></li>
          <li><a href="cart.html">Корзина</a></li>
          <li><a href="care.html">Уход за винилом</a></li>
          <li><a href="add_vinyl.html">Добавить пластинку</a></li>
          <li><a href="about.html">О нас</a></li>
        </ul>
      </nav>
    </header>

    <main class="main-content">
      <div class="catalog-div">
        <h1>Каталог виниловых пластинок</h1>
        <div class="catalog"></div>
        <div class="pagination">
          <button id="prev-page">Назад</button>
          <span id="current-page">1</span>
          <button id="next-page">Вперед</button>
        </div>
      </div>

      <aside class="sidebar">
        <div class="filters">
          <h2>Фильтры</h2>
          <label>
            Жанр:
            <select id="genre-filter">
              <option value="all">Все жанры</option>
              <option value="постпанк">Постпанк</option>
              <option value="альтернатива">Альтернатива</option>
              <option value="готик-рок">Готик-рок</option>
            </select>
          </label>
          <label>
            Год релиза:
            <input type="number" id="year-filter" min="1900" placeholder="Год релиза">
          </label>
          <label>
            Тип релиза:
            <select id="type-filter">
              <option value="all">Все</option>
              <option value="LP">LP</option>
              <option value="EP">EP</option>
              <option value="Single">Сингл</option>
            </select>
          </label>
          <label>
            Поиск:
            <input type="text" id="search-input" placeholder="Название альбома">
          </label>
          <label>
            Цена от:
            <input type="number" id="price-from" min="0" placeholder="0">
          </label>
          <label>
            Цена до:
            <input type="number" id="price-to" min="0" placeholder="10000">
          </label>
          <button id="apply-filters">Применить фильтры</button>
        </div>
      </aside>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const API_URL = '/api/Vinyls'; // Замените на ваш API endpoint
        let currentPage = 1;
        let totalPages = 1;

        const elements = {
          catalog: document.querySelector(".catalog"),
          currentPage: document.getElementById("current-page"),
          prevPage: document.getElementById("prev-page"),
          nextPage: document.getElementById("next-page"),
          filters: {
            genre: document.getElementById("genre-filter"),
            year: document.getElementById("year-filter"),
            type: document.getElementById("type-filter"),
            search: document.getElementById("search-input"),
            priceFrom: document.getElementById("price-from"),
            priceTo: document.getElementById("price-to")
          }
        };

        async function loadVinyls() {
          try {
            elements.catalog.classList.add("loading");

            const params = new URLSearchParams({
              page: currentPage,
              pageSize: 4,
              genre: elements.filters.genre.value,
              releaseYear: elements.filters.year.value,
              releaseType: elements.filters.type.value,
              search: elements.filters.search.value,
              minPrice: elements.filters.priceFrom.value,
              maxPrice: elements.filters.priceTo.value,
              sortBy: "year_desc"
            });

            const response = await fetch(`${API_URL}?${params}`);
            if (!response.ok) throw new Error('Ошибка загрузки данных');

            const { items, totalCount, pageSize } = await response.json();
            totalPages = Math.ceil(totalCount / pageSize);

            renderVinyls(items);
            updatePagination();
          } catch (error) {
            console.error('Ошибка:', error);
            elements.catalog.innerHTML = '<p>Ошибка загрузки данных</p>';
          } finally {
            elements.catalog.classList.remove("loading");
          }
        }

        function renderVinyls(vinyls) {
          elements.catalog.innerHTML = vinyls.map(vinyl => `
      <div class="record-card">
        <div class="image-container">
          <img src="${vinyl.coverUrl}" alt="${vinyl.albumName}">
        </div>
        <h2 class="title">${vinyl.albumName}</h2>
        <p class="artist">${vinyl.artistName}</p>
        <p class="genres">${vinyl.genres.join(', ')}</p>
        <p class="year">${vinyl.releaseYear}</p>
        <p class="type">${vinyl.releaseType}</p>
        <p class="price">${vinyl.price.toFixed(2)} руб.</p>
        <a href="/vinyls/${vinyl.vinylPlateId}" class="details-link">Подробнее</a>
      </div>
    `).join('');
        }

        function updatePagination() {
          elements.currentPage.textContent = currentPage;
          elements.prevPage.disabled = currentPage === 1;
          elements.nextPage.disabled = currentPage === totalPages;
        }

        // Обработчики событий
        document.getElementById("apply-filters").addEventListener("click", () => {
          currentPage = 1;
          loadVinyls();
        });

        elements.prevPage.addEventListener("click", () => {
          if (currentPage > 1) {
            currentPage--;
            loadVinyls();
          }
        });

        elements.nextPage.addEventListener("click", () => {
          if (currentPage < totalPages) {
            currentPage++;
            loadVinyls();
          }
        });

        // Дебаунс для поиска
        let searchTimeout;
        elements.filters.search.addEventListener("input", () => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            currentPage = 1;
            loadVinyls();
          }, 500);
        });

        // Первоначальная загрузка
        loadVinyls();
      });
    </script>
    </body>
    </html>